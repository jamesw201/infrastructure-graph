{"resources":[{"type":"variable","name":"vpc_cidr","body":{"description":"CIDR for the whole VPC","default":"10.0.0.0/16"}},{"type":"variable","name":"public_subnet_cidr","body":{"description":"CIDR for the Public Subnet","default":"10.0.0.0/24"}},{"type":"variable","name":"private_subnet_a_cidr","body":{"description":"CIDR for the Private Subnet","default":"10.0.64.0/20"}},{"type":"variable","name":"private_subnet_b_cidr","body":{"description":"CIDR for the Private Subnet","default":"10.0.128.0/20"}},{"type":"aws_cloudwatch_log_group","name":"discovery_vpc-flow-log-group","body":{"name":"/aws/vpc/discovery_flow-logs"}},{"type":"aws_vpc","name":"discovery_vpc","body":{"cidr_block":"var.vpc_cidr","instance_tenancy":"default","tags":{"Name":"discovery_vpc","Description":"discovery vpc used by Platform.S","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_eip","name":"discovery_nat-gateway-eip","body":{"vpc":"true"}},{"type":"aws_internet_gateway","name":"discovery_internet-gateway","body":{"vpc_id":"aws_vpc.discovery_vpc.id","tags":{"Name":"discovery_internet-gateway","Description":"discovery internet gateway","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_subnet","name":"discovery_public-subnet","body":{"vpc_id":"aws_vpc.discovery_vpc.id","cidr_block":"var.public_subnet_cidr","map_public_ip_on_launch":"true","depends_on":["aws_internet_gateway.discovery_internet-gateway"],"tags":{"Name":"discovery_public-subnet","Description":"discovery vpc public subnet used by Platform.S","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_subnet","name":"discovery_private-subnet-az-a","body":{"vpc_id":"aws_vpc.discovery_vpc.id","cidr_block":"var.private_subnet_a_cidr","availability_zone":"us-east-1a","tags":{"Name":"discovery_private-subnet-az-a","Description":"discovery vpc private subnet a used by Platform.S","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_subnet","name":"discovery_private-subnet-az-b","body":{"vpc_id":"aws_vpc.discovery_vpc.id","cidr_block":"var.private_subnet_b_cidr","availability_zone":"us-east-1c","tags":{"Name":"discovery_private-subnet-az-b","Description":"discovery vpc private subnet b used by Platform.S","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_nat_gateway","name":"discovery_nat-gateway","body":{"subnet_id":"aws_subnet.discovery_public-subnet.id","allocation_id":"aws_eip.discovery_nat-gateway-eip.id","depends_on":["aws_subnet.discovery_public-subnet","aws_eip.discovery_nat-gateway-eip","aws_internet_gateway.discovery_internet-gateway"]}},{"type":"aws_route_table","name":"discovery_public-route-table","body":{"vpc_id":"aws_vpc.discovery_vpc.id","tags":{"Name":"discovery_public-route-table","Description":"discovery Public Route Table","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_route","name":"discovery_public-route","body":{"route_table_id":"aws_route_table.discovery_public-route-table.id","gateway_id":"aws_internet_gateway.discovery_internet-gateway.id","destination_cidr_block":"0.0.0.0/0","depends_on":["aws_internet_gateway.discovery_internet-gateway","aws_route_table.discovery_public-route-table"]}},{"type":"aws_route_table","name":"discovery_private-route-table","body":{"vpc_id":"aws_vpc.discovery_vpc.id","tags":{"Name":"discovery_private-route-table","Description":"discovery Private Route Table","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_route","name":"discovery_private-route","body":{"route_table_id":"aws_route_table.discovery_private-route-table.id","nat_gateway_id":"aws_nat_gateway.discovery_nat-gateway.id","destination_cidr_block":"0.0.0.0/0","depends_on":["aws_nat_gateway.discovery_nat-gateway","aws_route_table.discovery_private-route-table"]}},{"type":"aws_route_table_association","name":"discovery_public-route-table-association","body":{"subnet_id":"aws_subnet.discovery_public-subnet.id","route_table_id":"aws_route_table.discovery_public-route-table.id","depends_on":["aws_subnet.discovery_public-subnet","aws_route_table.discovery_public-route-table"]}},{"type":"aws_main_route_table_association","name":"discovery_private-route-table-association","body":{"vpc_id":"aws_vpc.discovery_vpc.id","route_table_id":"aws_route_table.discovery_private-route-table.id","depends_on":["aws_subnet.discovery_private-subnet-az-a","aws_subnet.discovery_private-subnet-az-b","aws_route_table.discovery_private-route-table"]}},{"type":"aws_vpc_endpoint","name":"discovery_vpc-endpoint-s3","body":{"vpc_id":"aws_vpc.discovery_vpc.id","service_name":"com.amazonaws.%%region%%.s3","route_table_ids":["aws_route_table.discovery_public-route-table.id","aws_route_table.discovery_private-route-table.id"]}},{"type":"aws_vpc_endpoint","name":"discovery_vpc-endpoint-dynamodb","body":{"vpc_id":"aws_vpc.discovery_vpc.id","service_name":"com.amazonaws.%%region%%.dynamodb","route_table_ids":["aws_route_table.discovery_public-route-table.id","aws_route_table.discovery_private-route-table.id"]}},{"type":"aws_iam_role","name":"discovery_vpc-flow-log-role","body":{"name":"discovery_vpc-flow-log-role","assume_role_policy":{"Version":"2012-10-17","Statement":[{"Sid":"","Effect":"Allow","Principal":{"Service":"vpc-flow-logs.amazonaws.com"},"Action":"sts:AssumeRole"}]}}},{"type":"aws_iam_role_policy","name":"discovery_vpc-flow-log-policy","body":{"name":"discovery_vpc-flow-log-policy","role":"aws_iam_role.discovery_vpc-flow-log-role.id","policy":{"Version":"2012-10-17","Statement":[{"Sid":"AllowDescribeLogStreams","Effect":"Allow","Action":["logs:DescribeLogStreams"],"Resource":["arn:aws:logs:%%region%%:%%accountid%%:log-group:${aws_cloudwatch_log_group.discovery_vpc-flow-log-group.name}"]},{"Sid":"AllowCreationOfLogStream","Effect":"Allow","Action":["logs:CreateLogStream"],"Resource":["arn:aws:logs:%%region%%:%%accountid%%:log-group:${aws_cloudwatch_log_group.discovery_vpc-flow-log-group.name}:*"]},{"Sid":"AllowUploadOfLogEventsToLogStream","Effect":"Allow","Action":["logs:PutLogEvents"],"Resource":["arn:aws:logs:%%region%%:%%accountid%%:log-group:${aws_cloudwatch_log_group.discovery_vpc-flow-log-group.name}:*"]}]}}},{"type":"aws_flow_log","name":"discovery_vpc-flow-log","body":{"log_group_name":"aws_cloudwatch_log_group.discovery_vpc-flow-log-group.name","iam_role_arn":"aws_iam_role.discovery_vpc-flow-log-role.arn","vpc_id":"aws_vpc.discovery_vpc.id","traffic_type":"ALL"}},{"type":"aws_default_security_group","name":"default","body":{"vpc_id":"aws_vpc.discovery_vpc.id"}}],"relationships":[{"in":"aws_iam_role.discovery_vpc-flow-log-role","out":"","label":""}],"policy_results":{"aws_iam_role_policy_discovery_vpc-flow-log-policy":[{"filters":[{"filter":{"key":"visibility_timeout_seconds","op":"eq","value":"3.1"},"result":false}],"policy_id":"policy-id-check","policy_result":false}]}}